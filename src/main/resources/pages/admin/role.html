<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>角色管理</title>
    <link rel="stylesheet" href="../../static/css/font.css">
    <link rel="stylesheet" href="../../static/css/weadmin.css">
    <script src="/axios.min.js"></script>
</head>

<body>
<div class="weadmin-nav">
    <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">管理员管理</a>
        <a>
            <cite>角色管理</cite></a>
    </span>
</div>
<div class="weadmin-body">
    <div class="layui-row">
        <form class="layui-form layui-col-md12 we-search">
            <div class="layui-inline">
                <input type="text" name="username" placeholder="请输入角色名" autocomplete="off" class="layui-input">
            </div>
            <button class="layui-btn" lay-submit="" lay-filter="sreach"><i class="layui-icon">&#xe615;</i></button>
        </form>
    </div>
    <table class="layui-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>角色名</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody id="roleTableBody">
        <!-- 数据将通过 JavaScript 动态插入 -->
        </tbody>
    </table>
</div>

<script>
    function getRoles(roleName) {
        console.log(`请求的 URL: http://localhost:8080/roles/search?roleName=${roleName}`);
        axios.get(`http://localhost:8080/roles/search?roleName=${roleName}`)
            .then(function (response) {
                console.log('服务器返回的数据:', response.data); // 打印返回的数据
                const data = response.data;
                const tbody = document.querySelector('#roleTableBody');
                tbody.innerHTML = ''; // 清空表格内容

                if (data.code === 200) {
                    const roles = data.data;
                    if (Array.isArray(roles)) {
                        roles.forEach(role => {
                            const row = `
                                <tr>
                                    <td>${role.id}</td>
                                    <td>${role.roleName}</td>
                                    <td>
                                        <a href="javascript:;" title="编辑">编辑</a>
                                        <a href="javascript:;" title="删除" onclick="deleteRole(${role.id})">删除</a>
                                    </td>
                                </tr>`;
                            tbody.insertAdjacentHTML('beforeend', row);
                        });
                    } else {
                        console.error('数据格式错误:', data);
                    }
                } else {
                    alert(data.msg); // 显示错误信息
                }
            })
            .catch(function (error) {
                console.error('获取角色失败:', error);
            });
    }

    function deleteRole(id) {
        axios.delete(`http://localhost:8080/roles/delete/${id}`)
            .then(response => {
                console.log('角色删除成功:', response.data);
                // 重新加载角色列表
                getRoles(''); // 重新加载所有角色
            })
            .catch(error => {
                console.error('删除角色失败:', error);
            });
    }

    document.querySelector('.layui-form').addEventListener('submit', function (e) {
        e.preventDefault(); // 阻止表单提交
        const roleName = this.querySelector('input[name="username"]').value;
        getRoles(roleName); // 调用查询函数
    });

    document.addEventListener('DOMContentLoaded', function () {
        getRoles(''); // 初始加载所有角色
    });
</script>
</body>

</html>