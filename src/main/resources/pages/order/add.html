<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>添加订单-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../static/css/font.css">
    <link rel="stylesheet" href="../../static/css/weadmin.css">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="../../lib/layui/layui.js" charset="utf-8"></script>
</head>

<body>
    <div class="weadmin-body">
        <form class="layui-form" id="orderForm">
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>收货人
                </label>
                <div class="layui-input-inline">
                    <input type="text" name="recipientName" required lay-verify="required" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>总金额
                </label>
                <div class="layui-input-inline">
                    <input type="number" name="totalAmount" required lay-verify="required" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>应付金额
                </label>
                <div class="layui-input-inline">
                    <input type="number" name="payableAmount" required lay-verify="required" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>订单状态
                </label>
                <div class="layui-input-inline">
                    <select name="orderStatus" required lay-verify="required">
                        <option value="">请选择</option>
                        <option value="待支付">待支付</option>
                        <option value="已支付">已支付</option>
                        <option value="已取消">已取消</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>支付状态
                </label>
                <div class="layui-input-inline">
                    <select name="paymentStatus" required lay-verify="required">
                        <option value="">请选择</option>
                        <option value="未支付">未支付</option>
                        <option value="已支付">已支付</option>
                        <option value="已退款">已退款</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>发货状态
                </label>
                <div class="layui-input-inline">
                    <select name="shippingStatus" required lay-verify="required">
                        <option value="">请选择</option>
                        <option value="未发货">未发货</option>
                        <option value="已发货">已发货</option>
                        <option value="已收货">已收货</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>支付方式
                </label>
                <div class="layui-input-inline">
                    <select name="paymentMethod" required lay-verify="required">
                        <option value="">请选择</option>
                        <option value="支付宝">支付宝</option>
                        <option value="微信">微信</option>
                        <option value="货到付款">货到付款</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="we-red">*</span>配送方式
                </label>
                <div class="layui-input-inline">
                    <select name="deliveryMethod" required lay-verify="required">
                        <option value="">请选择</option>
                        <option value="顺丰">顺丰</option>
                        <option value="圆通">圆通</option>
                        <option value="中通">中通</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea name="remark" placeholder="请输入备注信息" class="layui-textarea"></textarea>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label"></label>
                <div class="layui-input-inline">
                    <button class="layui-btn" lay-submit lay-filter="add">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        layui.use(['form', 'layer'], function() {
            var form = layui.form,
                layer = layui.layer;

            //监听提交
            form.on('submit(add)', function(data) {
                // 准备请求数据
                var orderData = {
                    recipientName: data.field.recipientName,
                    totalAmount: parseFloat(data.field.totalAmount),
                    payableAmount: parseFloat(data.field.payableAmount),
                    orderStatus: data.field.orderStatus,
                    paymentStatus: data.field.paymentStatus,
                    shippingStatus: data.field.shippingStatus,
                    paymentMethod: data.field.paymentMethod,
                    deliveryMethod: data.field.deliveryMethod,
                    remark: data.field.remark,
                    orderTime: new Date().toISOString()
                };

                // 发送请求
                axios({
                    method: 'post',
                    url: 'http://localhost:8080/orders/add',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: orderData
                })
                .then(function(response) {
                    if (response.data.code === 200) {
                        layer.msg('添加成功！', {icon: 1}, function() {
                            // 跳转回列表页
                            window.location.href = './list.html';
                        });
                    } else {
                        layer.msg('添加失败：' + response.data.msg, {icon: 2});
                    }
                })
                .catch(function(error) {
                    console.error('添加订单失败:', error);
                    layer.msg('添加失败，请稍后重试', {icon: 2});
                });

                return false; // 阻止表单跳转
            });
        });
    </script>
</body>
</html>